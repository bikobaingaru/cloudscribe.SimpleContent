function ListItem(e,t,n,r,i,o,l,s){var a=this
a.Title=ko.observable(decodeEncodedJson(e)).extend({required:"Title is required"}),a.Description=ko.observable(decodeEncodedJson(t)),a.FullSizeUrl=ko.observable(n),a.ResizedUrl=ko.observable(r),a.ThumbnailUrl=ko.observable(i),a.LinkUrl=ko.observable(o).extend({required:"Link Url is required",isValidUrl:"Must be a valid url"}),a.Sort=ko.observable(l),a.OpensInNewWindow=ko.observable(s),a.incrementSort=function(){a.Sort(a.Sort()+3)},a.decrementSort=function(){var e=a.Sort()-3
0>e&&(e=0),a.Sort(e)},a._testEle=null,a.isValidUrl=function(e){if(e.startsWith("/"))return!0
a._testEle||(a._testEle=document.createElement("input"),a._testEle.setAttribute("type","url")),a._testEle.value=e
var t=a._testEle.validity.valid
return t}}function ItemListViewModel(e){var t=this
t.hiddenField=document.getElementById("ItemsJson"),t.handleSortItemChanged=function(e){t.sortItems()
var n=1
for(i=0;i<t.Items().length;i++){var r=t.Items()[i]
r.Sort.silentUpdate(n),n+=2}t.sortItems()},t.Items=ko.observableArray(ko.utils.arrayMap(e,function(e){var n=new ListItem(e.Title,e.Description,e.FullSizeUrl,e.ResizedUrl,e.ThumbnailUrl,e.LinkUrl,e.Sort,e.OpensInNewWindow)
return n.Sort.subscribe(t.handleSortItemChanged),n})),t.addItem=function(e,n,r,i,o,l,s,a){var d=new ListItem(e,n,r,i,o,l,s,a)
d.Sort.subscribe(t.handleSortItemChanged),t.Items.push(d),window.thisPage=window.thisPage||{},window.thisPage.hasUnsavedChanges=!0},t.newItemTitle=ko.observable(null).extend({required:"Title is required"}),t.newItemDescription=ko.observable(null),t.newItemFullSizeUrl=ko.observable(null),t.newItemResizedUrl=ko.observable(null),t.newItemThumbnailUrl=ko.observable(null),t.newItemLinkUrl=ko.observable(null).extend({isValidUrl:null}),t.newItemOpensInNewWindow=ko.observable(!1),t.newItemSort=function(){if(0===t.Items().length)return 1
var e=Math.max.apply(Math,t.Items().map(function(e){return e.Sort()}))
return e+2},t.addNewItem=function(){t.addItem(t.newItemTitle(),t.newItemDescription(),t.newItemFullSizeUrl(),t.newItemResizedUrl(),t.newItemThumbnailUrl(),t.newItemLinkUrl(),t.newItemSort(),t.newItemOpensInNewWindow()),t.newItemTitle(null),t.newItemDescription(null),t.newItemFullSizeUrl(null),t.newItemResizedUrl(null),t.newItemThumbnailUrl(null),t.newItemLinkUrl(null),t.newItemOpensInNewWindow(!1),window.cloudscribeDropAndCrop.clearAllItems()},t.removeItem=function(e){t.Items.remove(e),window.thisPage=window.thisPage||{},window.thisPage.hasUnsavedChanges=!0},t.getCssClass=function(e){return 0===e?"carousel-item active":"carousel-item"},t.dropZoneSuccess=function(e,n){t.newItemFullSizeUrl(n[0].originalUrl),t.newItemResizedUrl(n[0].resizedUrl),t.newItemThumbnailUrl(n[0].thumbUrl)},window.DropZoneSuccessHandler=t.dropZoneSuccess,t.handleCropSave=function(e){t.newItemResizedUrl(e)},window.HandleCropResult=t.handleCropSave,t.serverFileSelected=function(e){t.newItemResizedUrl(e)},window.ServerFileSelected=t.serverFileSelected,t.filteredItems=ko.computed(function(){return ko.utils.arrayFilter(t.Items(),function(e){return e.LinkUrl.hasError()===!1&&e.Title.hasError()===!1})}),t.currentListState=ko.computed(function(){return encodeURIComponent(ko.toJSON(t.filteredItems()))}),t.sortItems=function(){t.Items.sort(function(e,t){return e.Sort()<t.Sort()?-1:e.Sort()>t.Sort()?1:0})},t._testEle=null,t.isValidNewItemLink=ko.computed(function(){return t.newItemTitle.hasError()?!1:t.newItemLinkUrl.hasError()?!1:!0})}function decodeEncodedJson(e){if(null===e)return e
if(void 0===e)return e
var t=e.replace(/\+/g," ")
return decodeURIComponent(t)}ko.observable.fn.silentUpdate=function(e){this.notifySubscribers=function(){},this(e),this.notifySubscribers=function(){ko.subscribable.fn.notifySubscribers.apply(this,arguments)}},ko.extenders.required=function(e,t){function n(n){e.hasError(n?!1:!0),e.validationMessage(n?"":t||"This field is required")}return e.hasError=ko.observable(),e.validationMessage=ko.observable(),n(e()),e.subscribe(n),e},ko.extenders.isValidUrl=function(e,t){function n(t){if(t){if(t.startsWith("/"))return e.hasError(!1),void e.validationMessage("")
self._testEle||(r=document.createElement("input"),r.setAttribute("type","url")),r.value=t
var n=r.validity.valid
n?(e.hasError(!1),e.validationMessage("")):(e.hasError(!0),e.validationMessage("Must be a valid url"))}else e.hasError(t?!1:!0),e.validationMessage(t?"":"Url is required")}e.hasError=ko.observable(),e.validationMessage=ko.observable()
var r=null
return n(e()),e.subscribe(n),e},document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("ItemsConfig"),t=JSON.parse(decodeEncodedJson(e.value))
ko.applyBindings(new ItemListViewModel(t))})
